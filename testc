// Get the date range
Set(StartDate, DatePickerStart.SelectedDate);
Set(EndDate, DatePickerEnd.SelectedDate);

// Generate date range
ClearCollect(DateRange, 
  ForAll(
    Sequence(DateDiff(StartDate, EndDate) + 1, 0, 1), 
    {
      Date: DateAdd(StartDate, Value, Days)
    }
  )
);

// Collect reserved desks by location and date
ClearCollect(ReservationData,
  ForAll(
    DateRange,
    AddColumns(
      GroupBy(
        Filter(
          'Desk Reservations', 
          'Check Out From' = Date
        ),
        "DeskText",
        "Reservations"
      ),
      "Location",
      LookUp(Desks, Title = DeskText).Description,
      "ReservedCount",
      CountRows(Reservations)
    )
  )
);

// Collect available desks by location and date
ClearCollect(AvailabilityData,
  ForAll(
    DateRange,
    AddColumns(
      GroupBy(
        Desks,
        "Description",
        "Desks"
      ),
      "Date",
      Date,
      "AvailableCount",
      CountRows(Desks) - CountRows(
        Filter(
          'Desk Reservations',
          'DeskText' in Desks[@Title] && 'Check Out From' = Date
        )
      )
    )
  )
);

// Summarize data by location and date
ClearCollect(SummaryData,
  ForAll(
    DateRange,
    AddColumns(
      GroupBy(
        Filter(AvailabilityData, Date = Date),
        "Description",
        "Data"
      ),
      "Date",
      Date,
      "BookedDesks",
      Sum(Data, ReservedCount),
      "FreeDesks",
      Sum(Data, AvailableCount)
    )
  )
);
