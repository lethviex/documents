// Get the date range
Set(StartDate, DatePickerStart.SelectedDate);
Set(EndDate, DatePickerEnd.SelectedDate);

// Collect reserved desks grouped by location
ClearCollect(ReservedDesksByLocation,
  GroupBy(
    Filter(
      DeskReservationList,
      ReservationDate >= StartDate && ReservationDate <= EndDate
    ),
    "DeskID",
    "Reservations"
  )
);

// Collect available desks grouped by location
ClearCollect(DeskAvailability,
  AddColumns(
    DeskDetailsList,
    "ReservedCount",
    CountRows(
      Filter(
        ReservedDesksByLocation,
        DeskID = DeskDetailsList[@DeskID]
      )
    ),
    "AvailableCount",
    If(
      CountRows(
        Filter(
          ReservedDesksByLocation,
          DeskID = DeskDetailsList[@DeskID]
        )
      ) = 0,
      1,
      0
    )
  )
);

// Summarize data by location
ClearCollect(SummaryByLocation,
  AddColumns(
    GroupBy(
      DeskAvailability,
      "Location",
      "Desks"
    ),
    "BookedDesks",
    Sum(Desks, ReservedCount),
    "AvailableDesks",
    Sum(Desks, AvailableCount)
  )
);
