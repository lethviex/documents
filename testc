// Get the date range
Set(StartDate, DatePickerStart.SelectedDate);
Set(EndDate, DatePickerEnd.SelectedDate);

// Generate date range
ClearCollect(DateRange, 
  ForAll(
    Sequence(DateDiff(StartDate, EndDate) + 1, 0, 1), 
    {
      Date: DateAdd(StartDate, Value, Days)
    }
  )
);

// Collect reserved desks by location and date
ClearCollect(ReservationData,
  AddColumns(
    DateRange,
    "ReservedDesks", 
    ForAll(
      GroupBy(
        Filter(
          DeskReservationList, 
          ReservationDate = Date
        ),
        "DeskID",
        "Reservations"
      ),
      {
        Location: LookUp(DeskDetailsList, DeskID = Reservations.DeskID).Location,
        ReservedCount: CountRows(Reservations)
      }
    )
  )
);

// Collect available desks by location and date
ClearCollect(AvailabilityData,
  AddColumns(
    ReservationData,
    "AvailableDesks",
    ForAll(
      GroupBy(
        DeskDetailsList,
        "Location",
        "Desks"
      ),
      {
        Date: Date,
        Location: Location,
        AvailableCount: CountRows(Desks) - LookUp(ReservationData, Date = Date && Location = Location).ReservedCount
      }
    )
  )
);

// Summarize data by location and date
ClearCollect(SummaryData,
  AddColumns(
    GroupBy(
      AvailabilityData,
      "Date",
      "Data"
    ),
    "BookedDesks",
    Sum(Data, ReservedCount),
    "FreeDesks",
    Sum(Data, AvailableCount)
  )
);
