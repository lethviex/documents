from lxml import etree
import os

# Function to adjust column width
def adjust_column_width(xhtml_path, output_path):
    parser = etree.HTMLParser()
    tree = etree.parse(xhtml_path, parser)
    root = tree.getroot()

    # Find all tables
    tables = root.findall('.//table')
    
    for table in tables:
        # Find the header row
        header_row = table.find('.//tr')
        if header_row is not None:
            headers = header_row.findall('.//th')
            for idx, th in enumerate(headers):
                if th.text == "No":
                    # Found the "No" column, now find the maximum width of the values in this column
                    max_length = len("No")
                    for row in table.findall('.//tr')[1:]:  # Skip the header row
                        td = row.findall('.//td')[idx]
                        if td.text is not None:
                            max_length = max(max_length, len(td.text))
                    
                    # Set the width of the column header
                    th.set('style', f'width: {max_length}ch')
                    # Set the width for each cell in the "No" column
                    for row in table.findall('.//tr')[1:]:  # Skip the header row
                        td = row.findall('.//td')[idx]
                        td.set('style', f'width: {max_length}ch')

    # Write the modified XHTML to a new file
    tree.write(output_path, pretty_print=True, method='html', encoding='UTF-8')

# Path to your input XHTML file
xhtml_path = 'input.xhtml'
# Path to your output XHTML file
output_path = 'output.xhtml'

# Adjust column width
adjust_column_width(xhtml_path, output_path)

print(f"Processed file saved to {output_path}")
