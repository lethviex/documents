from pyVim.connect import SmartConnect, Disconnect
from pyVmomi import vim
import ssl

# Set up connection details
vcenter_server = 'YourVCenterServer'
username = 'YourUsername'
password = 'YourPassword'

# Ignore SSL certificate warnings (caution: security risk, use only in controlled environments)
context = ssl._create_unverified_context()

# Connect to vSphere
si = SmartConnect(host=vcenter_server, user=username, pwd=password, sslContext=context)

# Get the content object to retrieve other information
content = si.RetrieveContent()

# Get the resource details with DynamicID
dynamic_id = 'YourDynamicID'  # example: 'vm-1001' or 'host-123'
mo_ref = vim.ManagedObjectReference(_type=dynamic_id.split("-")[0], value=dynamic_id.split("-")[1])

# Get the managed object view
resource = content.vim.ServiceInstance.RetrieveContent().GetView(mo_ref, [])

# Display information about the resource
if isinstance(resource, vim.VirtualMachine):
    print("VM Name:", resource.name)
    print("VM Power State:", resource.runtime.powerState)
    print("VM Guest OS:", resource.config.guestFullName)
elif isinstance(resource, vim.HostSystem):
    print("Host Name:", resource.name)
    print("Host Connection State:", resource.runtime.connectionState)

# Clean up the connection
Disconnect(si)
