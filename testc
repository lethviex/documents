# Replace 'username' with the AD username for which you want to export the group membership
$UserName = "username"
$Domain = "yourdomain.com"

# Create a directory searcher object to find the user in AD
$Searcher = New-Object DirectoryServices.DirectorySearcher
$Searcher.Filter = "(&(objectCategory=person)(objectClass=user)(sAMAccountName=$UserName))"
$Searcher.PropertiesToLoad.Add("memberOf") | Out-Null

# Find the user
$User = $Searcher.FindOne()

# Check if user is found
if ($User -ne $null) {
    # Extract the groups' Distinguished Names (DNs)
    $Groups = $User.Properties["memberOf"]

    # Parse each group's DN to get just the group name
    $GroupNames = foreach ($GroupDN in $Groups) {
        $GroupDN -replace '^CN=([^,]+).+$', '$1'
    }

    # Ensure GroupNames are output as objects, not as their length
    $GroupNames | ForEach-Object {
        [PSCustomObject]@{
            GroupName = $_
        }
    } | Export-Csv -Path "C:\Path\To\Output\ADUserGroups.csv" -NoTypeInformation

    Write-Host "Group membership of $UserName has been exported to C:\Path\To\Output\ADUserGroups.csv"
} else {
    Write-Host "User $UserName not found in Active Directory."
}
